FROM openjdk:8-jre-alpine

ARG THIS_MODULE_NAME=ERTAUnknowModuleName

ENV INPUT_CONTENT_BASE_PATH=target/deploy/

ENV ERTA_APP_BASE_PATH=/usr/local/ERTA
ENV ERTA_APP_BASE_PATH_GLOBAL_CONFIG=$ERTA_APP_BASE_PATH/config

ENV THIS_MODULE_BASE_PATH=$ERTA_APP_BASE_PATH/$THIS_MODULE_NAME

ENV THIS_MODULE_BASE_PATH_CONFIG=$THIS_MODULE_BASE_PATH/libs
ENV THIS_MODULE_BASE_PATH_LIBS=$THIS_MODULE_BASE_PATH/libs
ENV THIS_MODULE_BASE_PATH_JARS=$THIS_MODULE_BASE_PATH/jars

ENV THIS_MODULE_JAR_FILE_NAME=$THIS_MODULE_NAME-0.0.1-SNAPSHOT.jar
ENV THIS_MODULE_JAR_FILE_PATH=$THIS_MODULE_BASE_PATH_JARS/$THIS_MODULE_JAR_FILE_NAME

RUN apk update && apk add bash

RUN apk add --no-cache bash

RUN mkdir -p $THIS_MODULE_BASE_PATH

COPY $INPUT_CONTENT_BASE_PATH  $ERTA_APP_BASE_PATH/

EXPOSE 8080 8888 8787 8080 8181 8200 9300 9092 3306 

ENV JAVA_OPTS="-Xdebug -Xrunjdwp:server=y,transport=dt_socket,address=8787,suspend=n -classpath $THIS_MODULE_BASE_PATH_JARS/*:$ERTA_APP_BASE_PATH_GLOBAL_CONFIG/:$ERTA_APP_BASE_PATH_GLOBAL_CONFIG"

RUN sh -c 'touch $THIS_MODULE_JAR_FILE_PATH'

ENTRYPOINT [ "sh", "-c", "java $JAVA_OPTS -Djava.security.egd=file:/dev/./urandom -Dspring.profiles.active=docker -jar $THIS_MODULE_JAR_FILE_PATH" ]

